{% load socialee_filters sekizai_tags %}

<div class="top-bar-app">
  <div class="top-bar-left">
    <ul class="menu">
      <li><a data-toggle="offCanvas"><i class="fa fa-bars" aria-hidden="true"></i></a></li>
      <li class="menu-text show-for-medium"><a id="daytime" href="/">Hallo bei Socialee!</a></li>
      <li class="menu-text show-for-small-only"><a href="/">Hallo bei Socialee!</a></li>
    </ul>
  </div>
  <span class="socialee-label-beta">BETA</span>
  <div class="top-bar-right show-for-large">
    {% if request.user.is_authenticated %}
    <ul class="dropdown menu" data-dropdown-menu>
      <li class="menu-text">
        <a id="js-instance" href="">
          {% if request.user.current_instance %}
            {{ request.user.current_instance.short_name }}
          {% else %}
            {% if request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.email }}{% endif %}
          {% endif %}
        </a>
        <ul class="menu">
          <li><a href="{% url 'welcome' request.user %}">Deine Übersicht</a></li>
          <li><a href="{% url 'account_change_password' %}">Passwort ändern</a></li>
          <li><a href="{% url 'account_logout' %}">Abmelden</a></li>
          <li><a>------------------</a></li>
          {% for instance in request.user.instances.all %}
            <li><a class="js-actAs" instance_slug="{{ instance.slug }}">{{ instance.slug }}</a></li>
          {% endfor %}
          {% if request.user.current_instance %}
            <li><a class="js-actAs" instance_slug="{{ request.user.username }}">
            {% if request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.email }}{% endif %}
            </a></li>
          {% endif %}
        </ul>
      </li>
    </ul>
    {% else %}
    <ul class="menu">
      <li class="menu-text"><a class="" href="{% url 'account_login' %}">Anmelden</a></li>
      <li class="menu-text"><a class="button button--yellow" href="{% url 'register' %}">Registrieren</a></li>
    </ul>
    {% endif %}
  </div>
</div>

{% addtoblock 'js' %}
<script type="text/javascript">
  $(document).ready(function(){

    var now = new Date();
    var hours = now.getHours();
    var msg;
    if ( hours > 5 && hours < 12 ) msg = "Guten Morgen bei Socialee";
    else if ( hours > 5 && hours < 14) msg = "Mahlzeit bei Socialee";
    else if ( hours > 5 && hours < 18) msg = "Guten Tag bei Socialee";
    else if ( hours > 5 && hours < 23) msg = "Schönen Abend bei Socialee";
    else msg = "Gute Nacht bei Socialee";

    $("#daytime").html(msg);
  });

  function actAs(object, instance_slug) {
    post_to_url( "/actAs/",
                { instance_slug : instance_slug },
                function(data){
                    object.html(data);
                });
  };

  $(".js-actAs").click( function() {
    actAs($("#js-instance"), $(this).attr('instance_slug'));
  });
</script>
{% endaddtoblock %}
