{% extends "offcanvas.html" %}
{% load static sekizai_tags %}

{% block content %}

<div class="c-section -solo">
  <div class="row">
    <div class="medium-10 medium-offset-1 large-8 large-offset-2 column">
      <div class="c-form">

        <h3 id="top_titel">Was ist deine Idee?</h3>
        <p class="lead">Egal, ob groß oder klein. Mit einer Idee fängt es immmer an.</p>

        <form method="POST" id="form_id" enctype="multipart/form-data">{% csrf_token %}

          <div id="idea_form">
            <img id="idea_image" src="#" alt="Deine Idee als Bild" />

            <div class="fieldset">
                {{ form.picture.errors }}
                <div class="form-label">{{ form.picture.label }}</div>
                  {% if form.picture.help_text %}
<!--                     <div class="second-form-label">{{ form.picture.help_text|safe }}</div>
 -->                  {% endif %}
                {{ form.picture }}
            <label for="id_picture" id="upload" class="button button--yellow"><i class="fa fa-upload" aria-hidden="true"></i> Bild hochladen </label>
            </div>

            <div class="fieldWrapper">
                {{ form.title.errors }}
                <div class="form-label">{{ form.title.label }}</div>
                  {% if form.title.help_text %}
<!--                     <div class="second-form-label">{{ form.title.help_text|safe }}</div>
 -->                  {% endif %}
                {{ form.title }}
            </div>

            <div class="fieldWrapper">
                {{ form.description.errors }}
                <div class="form-label">{{ form.description.label }}
                <label class="pull-right" for="id_description">70 Zeichen übrig</label>
                  {% if form.description.help_text %}
<!--                     <div class="second-form-label">{{ form.description.help_text|safe }}</div>
 -->                  {% endif %}</div>
                {{ form.description }}
            </div>

            <div class="c-form__footer">
              <div id="review_button" class="button button--yellow" >Vorschau deiner Idee</div>
              <a href="{% url 'idea_list' %}" class="text-link-special pull-right">zurück zur Übersicht</a></p>
            </div>

          </div>

          <div id="review">
            <div class="grid-item">
              <div class="idea-card-front">
                <div class="idea-image">
                  <img id="idea_img" src="">
                </div>
                <div class="idea-details">
                  <h2 id="idea_title"></h2>
                  <p id="idea_description"></p>
                </div>
                <div class="idea-heart">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-heart fa-stack-2x" aria-hidden="true"></i>
                    <strong class="fa-stack-1x">0</strong>
                  </span>
                </div>
              </div>
            </div>
            {% if not request.user.is_authenticated %}
            <div class="fieldWrapper">
              {{ form.email.errors }}
              <div class="form-label">{{ form.email.label }}</div>
                {% if form.email.help_text %}
<!--                   <div class="second-form-label">{{ form.email.help_text|safe }}</div>
 -->                {% endif %}
              {{ form.email }}
            </div>
            {% endif %}

            <div class="c-form__footer">
              <input class="button button--yellow" type="submit" value="Idee Absenden" />
              <a id="change" class="text-link-special float-right-md">Idee nochmal ändern</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% addtoblock 'js' %}
<script type="text/javascript">

function setNum() {
  var max = $(this).attr("max_length");
  if($(this).val().length > max)
  {
    $(this).val($(this).val().substring(0,max));
  }
  var num = max-$(this).val().length;
  var $label = $("label[for='"+this.id+"']");
  $label.html(num +" Zeichen übrig");
  if(num == 0)
    $label.css('color', 'red');
  else 
    $label.css('color', 'initial');
  }
$('.input_with_bound').each(setNum);
$('.input_with_bound').bind('input propertychange', setNum);


function readURL(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
          $("#idea_img").attr("src", e.target.result);
          $("#idea_image").show();
          $("#idea_image").attr("src", e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}

$("#id_picture").change(function(){
    readURL(this);
});

function fixPreview()
{
  $("#idea_form").children().hide();
  $("#idea_title").html($("#id_title").val());
  $("#idea_description").html($("#id_description").val());
  readURL($("#id_picture"));
}

{% if not form.email.errors %}
$("#review").hide();
$("#id_email").parent().hide();
{% else %}
$("#idea_form").children().hide();
fixPreview();
{% endif %}

$("#review_button").click(function()
  {
    if($("#id_title").val() || $("#id_description").val() || $("#id_picture").val())
    {
      $("#id_email").parent().show();
      fixPreview();
      $("#review").show();
      // TODO das hier darf nur angezeigt werden, wenn nicht angemeldet
      $("#top_desc").html("Du kannst noch deine E-Mail-Adresse eintragen, so findest du deine Idee besser wieder und kannst bald ein Projekt daraus machen."); 
      $("#top_titel").html("Sieht gut aus, oder?!");
    }
    else
    {
      $("#top_desc").html("Eines der Felder musst du aber schon ausfüllen ;-) Oder einfach nur ein Bild hochladen.");
    }

  });
$("#change").click(function()
  {
    $("#review").hide();
    $("#idea_form").children().show();
    $("#id_email").parent().hide();
    $("#top_desc").show();
    $("#top_desc").html("Mach sie nochmal hübscher...");
    $("#top_titel").html("Gute Idee!");
  });
</script>
{% endaddtoblock %}

{% endblock content %}
